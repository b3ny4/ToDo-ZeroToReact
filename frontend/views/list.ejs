<% layout('layout/boilerplate') %>
    <h1>ToDo List</h1>
    <div class="mb-3" id="list">
        <!-- <% //if(!todos || !todos.length) { %> -->
        <i>No ToDos. Well Done!</i>
        <!-- <% //} else { %>
                <ul class="list-group">
                    <% //for(todo of todos) { %>
                        <li class="list-group-item d-flex justify-content-between">
                            <div class="my-auto">
                                TODO CONTENT
                            </div>
                            <div class="my-auto">
                                <a class="btn btn-info" href="/TODO_ID/edit">EDIT</a>
                                <form class="d-inline" method="POST" action="/TODO_ID?_method=DELETE">
                                    <button class="btn btn-danger">DELETE</button>
                                </form>
                            </div>
                        </li>
                        <% //} %>
                </ul>
                <% //} %> -->
    </div>
    <div class="mb-3">
        <a class="btn btn-success" href="/new">Add ToDo</a>
    </div>

    <script>

        async function handleDeleteClick(id) {
            await axios.delete(`/${id}/`);
            window.location.href = '/';
        }

        async function handleEditClick(id) {
            window.location.href = `/${id}/edit`;
        }

        (async function getList() {
            const { data } = await axios.get("/");
            const { todos } = data;
            const list = document.getElementById("list");
            const ul = document.createElement("ul");
            ul.classList.add("list-group");
            list.innerHTML = "";
            list.appendChild(ul);
            todos.forEach(todo => {
                const li = document.createElement("li");
                li.classList.add("list-group-item", "d-flex", "justify-content-between");
                ul.appendChild(li);

                const content = document.createElement("div");
                content.classList.add("my-auto");
                content.innerText = todo.content;
                li.appendChild(content);

                const buttons = document.createElement("div");
                buttons.classList.add("my-auto");
                li.appendChild(buttons);

                const edit = document.createElement("button");
                edit.classList.add("btn", "btn-info");
                edit.innerText = "EDIT";
                edit.onclick = () => { handleEditClick(todo.id) };
                buttons.appendChild(edit);

                const delete_btn = document.createElement("button");
                delete_btn.classList.add("btn", "btn-danger");
                delete_btn.innerText = "DELETE";
                delete_btn.onclick = () => { handleDeleteClick(todo.id) };
                buttons.appendChild(delete_btn);
            });
        })();
    </script>